<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Boo-riculum â€“ Directions & Places</title>
  <link rel="icon" type="image/png" href="booha-ghost.png">
  <style>
    :root { --ink:#222; --muted:#444; --accent:#0b78ff; --ok:#22c55e; --bad:#ef4444; }
    html,body{height:100%;}
    body{
      margin:0;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Helvetica,Arial,sans-serif;
      color:var(--ink);
      /* updated bg name with space/case */
      background:url('Booha card.jpg') center/cover fixed no-repeat;
    }
    .wrap{max-width:900px;margin:0 auto;padding:16px 16px 24px;}
    header{
      display:flex;flex-wrap:wrap;gap:12px;align-items:center;justify-content:space-between;
      margin-bottom:12px;background:rgba(255,255,255,0.88);padding:12px 16px;
      border-radius:16px;box-shadow:0 4px 10px rgba(0,0,0,0.15)
    }
    header h1{
      font-size:18px;margin:0;font-weight:700;letter-spacing:.2px;
      background:linear-gradient(90deg,#7dd3fc,#60a5fa,#a78bfa,#f472b6);
      -webkit-background-clip:text;-webkit-text-fill-color:transparent;
      display:flex;align-items:center;gap:8px
    }
    header h1 img{height:28px;width:auto;}
    .controls{display:flex;flex-wrap:wrap;gap:8px;align-items:center}
    select,button{
      background:rgba(255,255,255,0.95);color:var(--ink);border:1px solid #ccc;
      border-radius:12px;padding:10px 12px;font-size:14px;
      box-shadow:0 2px 5px rgba(0,0,0,0.08)
    }
    button{cursor:pointer;transition:transform .05s ease, background .2s}
    button:hover{background:#f0f0f0}
    button:active{transform:scale(.98)}
    .pill{border:1px solid #ccc;border-radius:999px;padding:6px 10px;font-size:12px;background:rgba(255,255,255,0.7)}
    .card{
      user-select:none;-webkit-user-select:none;display:flex;flex-direction:column;justify-content:center;align-items:center;
      text-align:center;
      /* updated inner bg name too */
      background:url('Booha card.jpg') center/cover no-repeat;
      border:1px solid #ccc;border-radius:24px;min-height:56vh;margin:16px auto;padding:22px 18px 28px;
      box-shadow:0 10px 40px rgba(0,0,0,.25); position:relative;
    }
    .brand{
      position:absolute;top:10px;left:12px;display:flex;gap:8px;align-items:center;
      background:rgba(255,255,255,0.85);padding:6px 10px;border-radius:12px;border:1px solid #ddd;
      box-shadow:0 2px 6px rgba(0,0,0,0.08); font-weight:800; letter-spacing:.2px;
    }
    .brand img{height:20px;width:auto}
    .brand span{background:linear-gradient(90deg,#7dd3fc,#60a5fa,#a78bfa,#f472b6);
      -webkit-background-clip:text;-webkit-text-fill-color:transparent;}
    .label{color:var(--muted);font-size:13px;letter-spacing:.3px;margin-bottom:8px;
      background:rgba(255,255,255,0.7);padding:4px 8px;border-radius:8px}
    .main{font-size:28px;line-height:1.25;font-weight:800;margin:8px 0 10px;
      background:rgba(255,255,255,0.86);padding:8px 12px;border-radius:12px; white-space:pre-line;}
    .sub{font-size:18px;opacity:.92;margin:0 0 6px;background:rgba(255,255,255,0.65);
      padding:4px 10px;border-radius:8px}
    .hira{font-size:18px;color:var(--accent);opacity:.95;background:rgba(255,255,255,0.75);
      padding:4px 10px;border-radius:8px}
    .muted{color:var(--muted)}
    .row{display:flex;gap:8px;flex-wrap:wrap;justify-content:center}
    .footer{
      display:flex;align-items:center;justify-content:space-between;margin-top:8px;color:var(--muted);font-size:13px;
      background:rgba(255,255,255,0.85);padding:8px 12px;border-radius:12px;box-shadow:0 2px 8px rgba(0,0,0,0.1)
    }
    .progress{height:8px;border-radius:999px;background:#eee;overflow:hidden}
    .progress>span{display:block;height:100%;background:linear-gradient(90deg,#7dd3fc,#60a5fa,#a78bfa,#f472b6);width:0%}
    .hidden{display:none}
    .options{display:flex;gap:10px;flex-wrap:wrap;justify-content:center;margin-top:12px}
    .optbtn{border:1px solid #ccc;border-radius:12px;padding:10px 14px;background:rgba(255,255,255,0.95);cursor:pointer}
    .optbtn.ok{background:#dcfce7;border-color:#86efac;color:#166534}
    .optbtn.bad{background:#fee2e2;border-color:#fca5a5;color:#991b1b}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1><img src="booha-ghost.png" alt="Booha ghost"> Boo-riculum â€“ Directions & Places</h1>
      <div class="controls">
        <select id="mode" aria-label="Mode">
          <option value="vocab-j2e">Vocab: ğŸ‡¯ğŸ‡µ â†’ ğŸ‡ºğŸ‡¸</option>
          <option value="vocab-e2j">Vocab: ğŸ‡ºğŸ‡¸ â†’ ğŸ‡¯ğŸ‡µ</option>
          <option value="sentences">Sentences (practice)</option>
          <option value="qa">Questions (practice)</option>
          <option value="quiz">Quiz (multiple choice)</option>
          <option value="reading">Reading</option>
          <option value="diary">Diary Prompts</option>
        </select>
      </div>
    </header>

    <div id="card" class="card" role="button" aria-label="flashcard" tabindex="0">
      <div class="brand"><img src="booha-ghost.png" alt="Booha ghost"><span>Boo-riculum</span></div>
      <div id="label" class="label">Front</div>
      <div id="main" class="main">â€”</div>
      <div id="sub" class="sub muted">Tap or press Space to flip</div>
      <div id="hira" class="hira hidden"></div>
      <div id="mcArea" class="options hidden"></div>
    </div>

    <div class="footer">
      <div class="row">
        <span class="pill">Keyboard: â† â†’</span>
        <span class="pill">Space = Flip</span>
        <button id="btnPrev">â—€ï¸ Prev</button>
        <button id="btnFlip">Flip</button>
        <button id="btnNext">Next â–¶ï¸</button>
        <button id="btnShuffle">Shuffle</button>
      </div>
      <div style="min-width:180px;text-align:right">
        <div id="counter" class="muted">0 / 0</div>
        <div class="progress"><span id="bar"></span></div>
      </div>
    </div>
  </div>

  <script>
    // ---------------- Data: Directions & Places ----------------
    const VOCAB = [
      { en:'left', ja:'å·¦', hira:'ã²ã ã‚Š' },
      { en:'right', ja:'å³', hira:'ã¿ã' },
      { en:'straight', ja:'ã¾ã£ã™ã', hira:'ã¾ã£ã™ã' },
      { en:'turn', ja:'æ›²ãŒã‚‹', hira:'ã¾ãŒã‚‹' },
      { en:'ahead', ja:'å‰æ–¹', hira:'ã¾ãˆ' },
      { en:'next to', ja:'éš£', hira:'ã¨ãªã‚Š' },
      { en:'across from', ja:'å‘ã‹ã„å´', hira:'ã‚€ã‹ã„ãŒã‚' },
      { en:'beside', ja:'ãã°', hira:'ãã°' },
      { en:'between', ja:'é–“', hira:'ã‚ã„ã ' },
      { en:'corner', ja:'è§’', hira:'ã‹ã©' },

      { en:'station', ja:'é§…', hira:'ãˆã' },
      { en:'bus stop', ja:'ãƒã‚¹åœ', hira:'ã°ã™ã¦ã„' },
      { en:'supermarket', ja:'ã‚¹ãƒ¼ãƒ‘ãƒ¼ãƒãƒ¼ã‚±ãƒƒãƒˆ', hira:'ã‚¹ãƒ¼ãƒ‘ãƒ¼' },
      { en:'park', ja:'å…¬åœ’', hira:'ã“ã†ãˆã‚“' },
      { en:'school', ja:'å­¦æ ¡', hira:'ãŒã£ã“ã†' },
      { en:'restaurant', ja:'ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³', hira:'ã‚Œã™ã¨ã‚‰ã‚“' },
      { en:'hospital', ja:'ç—…é™¢', hira:'ã³ã‚‡ã†ã„ã‚“' },
      { en:'post office', ja:'éƒµä¾¿å±€', hira:'ã‚†ã†ã³ã‚“ãã‚‡ã' },
      { en:'airport', ja:'ç©ºæ¸¯', hira:'ãã†ã“ã†' },
      { en:'subway', ja:'åœ°ä¸‹é‰„', hira:'ã¡ã‹ã¦ã¤' },
    ];

    const SENTENCES = [
      { en:'How do I get to the bus station?', ja:'ãƒã‚¹åœã¸ã¯ã©ã†ã‚„ã£ã¦è¡Œã‘ã°ã„ã„ã§ã™ã‹ï¼Ÿ', hira:'ã°ã™ã¦ã„ ã¸ ã¯ ã©ã†ã‚„ã£ã¦ ã„ã‘ã° ã„ã„ã§ã™ã‹ï¼Ÿ' },
      { en:'Where is the nearest subway?', ja:'ä¸€ç•ªè¿‘ã„åœ°ä¸‹é‰„ã¯ã©ã“ã§ã™ã‹ï¼Ÿ', hira:'ã„ã¡ã°ã‚“ ã¡ã‹ã„ ã¡ã‹ã¦ã¤ ã¯ ã©ã“ ã§ã™ã‹ï¼Ÿ' },
      { en:'Is the restaurant far from here?', ja:'ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³ã¯ã“ã“ã‹ã‚‰é ã„ã§ã™ã‹ï¼Ÿ', hira:'ã‚Œã™ã¨ã‚‰ã‚“ ã¯ ã“ã“ ã‹ã‚‰ ã¨ãŠã„ ã§ã™ã‹ï¼Ÿ' },
      { en:'The bus stop is on the left.', ja:'ãƒã‚¹åœã¯å·¦å´ã«ã‚ã‚Šã¾ã™ã€‚', hira:'ã°ã™ã¦ã„ ã¯ ã²ã ã‚ŠãŒã‚ ã« ã‚ã‚Šã¾ã™ã€‚' },
      { en:'Turn right at the corner.', ja:'è§’ã§å³ã«æ›²ãŒã£ã¦ãã ã•ã„ã€‚', hira:'ã‹ã© ã§ ã¿ã ã« ã¾ãŒã£ã¦ ãã ã•ã„ã€‚' },
      { en:'Go straight ahead and you will see the supermarket.', ja:'ã¾ã£ã™ãé€²ã‚“ã§ã„ãã¨ã€ã‚¹ãƒ¼ãƒ‘ãƒ¼ãŒè¦‹ãˆã¾ã™ã€‚', hira:'ã¾ã£ã™ã ã™ã™ã‚“ã§ ã„ã ã¨ã€ ã™ãƒ¼ã±ãƒ¼ ãŒ ã¿ãˆã¾ã™ã€‚' },
      { en:'The park is next to the school.', ja:'å…¬åœ’ã¯å­¦æ ¡ã®éš£ã«ã‚ã‚Šã¾ã™ã€‚', hira:'ã“ã†ãˆã‚“ ã¯ ãŒã£ã“ã† ã® ã¨ãªã‚Š ã« ã‚ã‚Šã¾ã™ã€‚' },
      { en:'The restaurant is across from the hospital.', ja:'ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³ã¯ç—…é™¢ã®å‘ã‹ã„ã«ã‚ã‚Šã¾ã™ã€‚', hira:'ã‚Œã™ã¨ã‚‰ã‚“ ã¯ ã³ã‚‡ã†ã„ã‚“ ã® ã‚€ã‹ã„ ã« ã‚ã‚Šã¾ã™ã€‚' },
      { en:'The bus station is beside the airport.', ja:'ãƒã‚¹é§…ã¯ç©ºæ¸¯ã®æ¨ªã«ã‚ã‚Šã¾ã™ã€‚', hira:'ã°ã™ãˆã ã¯ ãã†ã“ã† ã® ã‚ˆã“ ã« ã‚ã‚Šã¾ã™ã€‚' },
      { en:'The subway station is between the park and the supermarket.', ja:'åœ°ä¸‹é‰„ã®é§…ã¯å…¬åœ’ã¨ã‚¹ãƒ¼ãƒ‘ãƒ¼ã®é–“ã«ã‚ã‚Šã¾ã™ã€‚', hira:'ã¡ã‹ã¦ã¤ ã® ãˆã ã¯ ã“ã†ãˆã‚“ ã¨ ã™ãƒ¼ã±ãƒ¼ ã® ã‚ã„ã  ã« ã‚ã‚Šã¾ã™ã€‚' },
      { en:'The school is straight ahead.', ja:'å­¦æ ¡ã¯ã¾ã£ã™ãé€²ã‚“ã å…ˆã«ã‚ã‚Šã¾ã™ã€‚', hira:'ãŒã£ã“ã† ã¯ ã¾ã£ã™ã ã™ã™ã‚“ã  ã•ã ã« ã‚ã‚Šã¾ã™ã€‚' },

      { en:'Turn left at the traffic light.', ja:'ä¿¡å·ã§å·¦ã«æ›²ãŒã£ã¦ãã ã•ã„ã€‚', hira:'ã—ã‚“ã”ã† ã§ ã²ã ã‚Š ã« ã¾ãŒã£ã¦ ãã ã•ã„ã€‚' },
      { en:'Go straight and turn right at the corner.', ja:'ã¾ã£ã™ãè¡Œã£ã¦ã€è§’ã§å³ã«æ›²ãŒã£ã¦ãã ã•ã„ã€‚', hira:'ã¾ã£ã™ã ã„ã£ã¦ã€ ã‹ã© ã§ ã¿ã ã« ã¾ãŒã£ã¦ ãã ã•ã„ã€‚' },
      { en:'The post office is across from the station.', ja:'éƒµä¾¿å±€ã¯é§…ã®å‘ã‹ã„ã«ã‚ã‚Šã¾ã™ã€‚', hira:'ã‚†ã†ã³ã‚“ãã‚‡ã ã¯ ãˆã ã® ã‚€ã‹ã„ ã« ã‚ã‚Šã¾ã™ã€‚' },
      { en:'The hospital is next to the restaurant.', ja:'ç—…é™¢ã¯ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³ã®éš£ã«ã‚ã‚Šã¾ã™ã€‚', hira:'ã³ã‚‡ã†ã„ã‚“ ã¯ ã‚Œã™ã¨ã‚‰ã‚“ ã® ã¨ãªã‚Š ã« ã‚ã‚Šã¾ã™ã€‚' },
      { en:'Is the park far from the school?', ja:'å…¬åœ’ã¯å­¦æ ¡ã‹ã‚‰é ã„ã§ã™ã‹ï¼Ÿ', hira:'ã“ã†ãˆã‚“ ã¯ ãŒã£ã“ã† ã‹ã‚‰ ã¨ãŠã„ ã§ã™ã‹ï¼Ÿ' },
      { en:'Go straight ahead until the station.', ja:'é§…ã¾ã§ã¾ã£ã™ãé€²ã‚“ã§ãã ã•ã„ã€‚', hira:'ãˆã ã¾ã§ ã¾ã£ã™ã ã™ã™ã‚“ã§ ãã ã•ã„ã€‚' },
      { en:'Turn right after the bus stop.', ja:'ãƒã‚¹åœã®ã‚ã¨ã§å³ã«æ›²ãŒã£ã¦ãã ã•ã„ã€‚', hira:'ã°ã™ã¦ã„ ã® ã‚ã¨ ã§ ã¿ã ã« ã¾ãŒã£ã¦ ãã ã•ã„ã€‚' },
      { en:'The airport is between the city and the sea.', ja:'ç©ºæ¸¯ã¯è¡—ã¨æµ·ã®é–“ã«ã‚ã‚Šã¾ã™ã€‚', hira:'ãã†ã“ã† ã¯ ã¾ã¡ ã¨ ã†ã¿ ã® ã‚ã„ã  ã« ã‚ã‚Šã¾ã™ã€‚' },
      { en:'The supermarket is beside the post office.', ja:'ã‚¹ãƒ¼ãƒ‘ãƒ¼ã¯éƒµä¾¿å±€ã®ãã°ã«ã‚ã‚Šã¾ã™ã€‚', hira:'ã™ãƒ¼ã±ãƒ¼ ã¯ ã‚†ã†ã³ã‚“ãã‚‡ã ã® ãã° ã« ã‚ã‚Šã¾ã™ã€‚' },
    ];

    const QA = [
      { q_en:'Where is the bus stop?', q_ja:'ãƒã‚¹åœã¯ã©ã“ã§ã™ã‹ï¼Ÿ', q_hira:'ã°ã™ã¦ã„ ã¯ ã©ã“ ã§ã™ã‹ï¼Ÿ',
        a_en:'It is on the left.', a_ja:'å·¦å´ã«ã‚ã‚Šã¾ã™ã€‚', a_hira:'ã²ã ã‚ŠãŒã‚ ã« ã‚ã‚Šã¾ã™ã€‚' },
      { q_en:'How do I get to the station?', q_ja:'é§…ã¸ã¯ã©ã†ã‚„ã£ã¦è¡Œãã¾ã™ã‹ï¼Ÿ', q_hira:'ãˆã ã¸ ã¯ ã©ã†ã‚„ã£ã¦ ã„ãã¾ã™ã‹ï¼Ÿ',
        a_en:'Go straight and turn right.', a_ja:'ã¾ã£ã™ãè¡Œã£ã¦å³ã«æ›²ãŒã£ã¦ãã ã•ã„ã€‚', a_hira:'ã¾ã£ã™ã ã„ã£ã¦ ã¿ã ã« ã¾ãŒã£ã¦ ãã ã•ã„ã€‚' },
      { q_en:'Where is the nearest subway?', q_ja:'ä¸€ç•ªè¿‘ã„åœ°ä¸‹é‰„ã¯ã©ã“ã§ã™ã‹ï¼Ÿ', q_hira:'ã„ã¡ã°ã‚“ ã¡ã‹ã„ ã¡ã‹ã¦ã¤ ã¯ ã©ã“ ã§ã™ã‹ï¼Ÿ',
        a_en:'Across from the park.', a_ja:'å…¬åœ’ã®å‘ã‹ã„ã§ã™ã€‚', a_hira:'ã“ã†ãˆã‚“ ã® ã‚€ã‹ã„ ã§ã™ã€‚' },
      { q_en:'Is the restaurant far from here?', q_ja:'ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³ã¯ã“ã“ã‹ã‚‰é ã„ã§ã™ã‹ï¼Ÿ', q_hira:'ã‚Œã™ã¨ã‚‰ã‚“ ã¯ ã“ã“ ã‹ã‚‰ ã¨ãŠã„ ã§ã™ã‹ï¼Ÿ',
        a_en:'No, it is next to the school.', a_ja:'ã„ã„ãˆã€å­¦æ ¡ã®éš£ã§ã™ã€‚', a_hira:'ã„ã„ãˆã€ ãŒã£ã“ã† ã® ã¨ãªã‚Š ã§ã™ã€‚' },
      { q_en:'Where is the post office?', q_ja:'éƒµä¾¿å±€ã¯ã©ã“ã§ã™ã‹ï¼Ÿ', q_hira:'ã‚†ã†ã³ã‚“ãã‚‡ã ã¯ ã©ã“ ã§ã™ã‹ï¼Ÿ',
        a_en:'Beside the station.', a_ja:'é§…ã®ãã°ã§ã™ã€‚', a_hira:'ãˆã ã® ãã° ã§ã™ã€‚' },
      { q_en:'Which way should I turn?', q_ja:'ã©ã¡ã‚‰ã«æ›²ãŒã‚Œã°ã„ã„ã§ã™ã‹ï¼Ÿ', q_hira:'ã©ã¡ã‚‰ ã« ã¾ãŒã‚Œã° ã„ã„ ã§ã™ã‹ï¼Ÿ',
        a_en:'Turn left at the corner.', a_ja:'è§’ã§å·¦ã«æ›²ãŒã£ã¦ãã ã•ã„ã€‚', a_hira:'ã‹ã© ã§ ã²ã ã‚Š ã« ã¾ãŒã£ã¦ ãã ã•ã„ã€‚' },
      { q_en:'Is the park ahead?', q_ja:'å…¬åœ’ã¯å‰æ–¹ã§ã™ã‹ï¼Ÿ', q_hira:'ã“ã†ãˆã‚“ ã¯ ãœã‚“ã½ã† ã§ã™ã‹ï¼Ÿ',
        a_en:'Yes, go straight ahead.', a_ja:'ã¯ã„ã€ã¾ã£ã™ãé€²ã‚“ã§ãã ã•ã„ã€‚', a_hira:'ã¯ã„ã€ ã¾ã£ã™ã ã™ã™ã‚“ã§ ãã ã•ã„ã€‚' },
      { q_en:'Where is the airport?', q_ja:'ç©ºæ¸¯ã¯ã©ã“ã§ã™ã‹ï¼Ÿ', q_hira:'ãã†ã“ã† ã¯ ã©ã“ ã§ã™ã‹ï¼Ÿ',
        a_en:'Between the city and the sea.', a_ja:'è¡—ã¨æµ·ã®é–“ã§ã™ã€‚', a_hira:'ã¾ã¡ ã¨ ã†ã¿ ã® ã‚ã„ã  ã§ã™ã€‚' },
      { q_en:'Is the school across from the hospital?', q_ja:'å­¦æ ¡ã¯ç—…é™¢ã®å‘ã‹ã„ã§ã™ã‹ï¼Ÿ', q_hira:'ãŒã£ã“ã† ã¯ ã³ã‚‡ã†ã„ã‚“ ã® ã‚€ã‹ã„ ã§ã™ã‹ï¼Ÿ',
        a_en:'No, it is next to the park.', a_ja:'ã„ã„ãˆã€å…¬åœ’ã®éš£ã§ã™ã€‚', a_hira:'ã„ã„ãˆã€ ã“ã†ãˆã‚“ ã® ã¨ãªã‚Š ã§ã™ã€‚' },
      { q_en:'How can I reach the supermarket?', q_ja:'ã‚¹ãƒ¼ãƒ‘ãƒ¼ã«ã¯ã©ã†ã‚„ã£ã¦è¡Œã‘ã¾ã™ã‹ï¼Ÿ', q_hira:'ã™ãƒ¼ã±ãƒ¼ ã«ã¯ ã©ã†ã‚„ã£ã¦ ã„ã‘ã¾ã™ã‹ï¼Ÿ',
        a_en:'Go straight and you will see it.', a_ja:'ã¾ã£ã™ãé€²ã‚€ã¨è¦‹ãˆã¾ã™ã€‚', a_hira:'ã¾ã£ã™ã ã™ã™ã‚€ ã¨ ã¿ãˆã¾ã™ã€‚' },

      { q_en:'Where is the restaurant?', q_ja:'ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³ã¯ã©ã“ã§ã™ã‹ï¼Ÿ', q_hira:'ã‚Œã™ã¨ã‚‰ã‚“ ã¯ ã©ã“ ã§ã™ã‹ï¼Ÿ',
        a_en:'Across from the post office.', a_ja:'éƒµä¾¿å±€ã®å‘ã‹ã„ã§ã™ã€‚', a_hira:'ã‚†ã†ã³ã‚“ãã‚‡ã ã® ã‚€ã‹ã„ ã§ã™ã€‚' },
      { q_en:'Is the bus stop near the school?', q_ja:'ãƒã‚¹åœã¯å­¦æ ¡ã®è¿‘ãã§ã™ã‹ï¼Ÿ', q_hira:'ã°ã™ã¦ã„ ã¯ ãŒã£ã“ã† ã® ã¡ã‹ã ã§ã™ã‹ï¼Ÿ',
        a_en:'Yes, it is beside the gate.', a_ja:'ã¯ã„ã€é–€ã®ãã°ã§ã™ã€‚', a_hira:'ã¯ã„ã€ ã‚‚ã‚“ ã® ãã° ã§ã™ã€‚' },
      { q_en:'Should I go left or right?', q_ja:'å·¦ã¨å³ã€ã©ã¡ã‚‰ã«è¡Œã‘ã°ã„ã„ã§ã™ã‹ï¼Ÿ', q_hira:'ã²ã ã‚Š ã¨ ã¿ãã€ ã©ã¡ã‚‰ ã« ã„ã‘ã° ã„ã„ ã§ã™ã‹ï¼Ÿ',
        a_en:'Go right at the corner.', a_ja:'è§’ã§å³ã«è¡Œã£ã¦ãã ã•ã„ã€‚', a_hira:'ã‹ã© ã§ ã¿ã ã« ã„ã£ã¦ ãã ã•ã„ã€‚' },
      { q_en:'Is the airport far?', q_ja:'ç©ºæ¸¯ã¯é ã„ã§ã™ã‹ï¼Ÿ', q_hira:'ãã†ã“ã† ã¯ ã¨ãŠã„ ã§ã™ã‹ï¼Ÿ',
        a_en:'No, it is ahead.', a_ja:'ã„ã„ãˆã€å‰æ–¹ã§ã™ã€‚', a_hira:'ã„ã„ãˆã€ ã¾ãˆ ã§ã™ã€‚' },
      { q_en:'Where is the station entrance?', q_ja:'é§…ã®å…¥å£ã¯ã©ã“ã§ã™ã‹ï¼Ÿ', q_hira:'ãˆã ã® ã„ã‚Šãã¡ ã¯ ã©ã“ ã§ã™ã‹ï¼Ÿ',
        a_en:'Next to the bus stop.', a_ja:'ãƒã‚¹åœã®éš£ã§ã™ã€‚', a_hira:'ã°ã™ã¦ã„ ã® ã¨ãªã‚Š ã§ã™ã€‚' },
      { q_en:'Is the hospital between the park and the school?', q_ja:'ç—…é™¢ã¯å…¬åœ’ã¨å­¦æ ¡ã®é–“ã§ã™ã‹ï¼Ÿ', q_hira:'ã³ã‚‡ã†ã„ã‚“ ã¯ ã“ã†ãˆã‚“ ã¨ ãŒã£ã“ã† ã® ã‚ã„ã  ã§ã™ã‹ï¼Ÿ',
        a_en:'Yes, that is right.', a_ja:'ã¯ã„ã€ãã®ã¨ãŠã‚Šã§ã™ã€‚', a_hira:'ã¯ã„ã€ ãã® ã¨ãŠã‚Š ã§ã™ã€‚' },
      { q_en:'Where is the post office from here?', q_ja:'ã“ã“ã‹ã‚‰éƒµä¾¿å±€ã¯ã©ã“ã§ã™ã‹ï¼Ÿ', q_hira:'ã“ã“ ã‹ã‚‰ ã‚†ã†ã³ã‚“ãã‚‡ã ã¯ ã©ã“ ã§ã™ã‹ï¼Ÿ',
        a_en:'Go straight ahead.', a_ja:'ã¾ã£ã™ãå‰ã§ã™ã€‚', a_hira:'ã¾ã£ã™ã ã¾ãˆ ã§ã™ã€‚' },
      { q_en:'How can I get to the airport quickly?', q_ja:'ç©ºæ¸¯ã¸æ—©ãè¡Œãã«ã¯ã©ã†ã™ã‚Œã°ã„ã„ã§ã™ã‹ï¼Ÿ', q_hira:'ãã†ã“ã† ã¸ ã¯ã‚„ã ã„ã ã«ã¯ ã©ã† ã™ã‚Œã° ã„ã„ ã§ã™ã‹ï¼Ÿ',
        a_en:'Take the subway at the station.', a_ja:'é§…ã§åœ°ä¸‹é‰„ã«ä¹—ã£ã¦ãã ã•ã„ã€‚', a_hira:'ãˆã ã§ ã¡ã‹ã¦ã¤ ã« ã®ã£ã¦ ãã ã•ã„ã€‚' },
      { q_en:'Is the restaurant beside the station?', q_ja:'ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³ã¯é§…ã®ãã°ã§ã™ã‹ï¼Ÿ', q_hira:'ã‚Œã™ã¨ã‚‰ã‚“ ã¯ ãˆã ã® ãã° ã§ã™ã‹ï¼Ÿ',
        a_en:'Yes, beside the west exit.', a_ja:'ã¯ã„ã€è¥¿å£ã®ãã°ã§ã™ã€‚', a_hira:'ã¯ã„ã€ ã«ã—ãã¡ ã® ãã° ã§ã™ã€‚' },
      { q_en:'Where should I meet you?', q_ja:'ã©ã“ã§ä¼šãˆã°ã„ã„ã§ã™ã‹ï¼Ÿ', q_hira:'ã©ã“ ã§ ã‚ãˆã° ã„ã„ ã§ã™ã‹ï¼Ÿ',
        a_en:'At the park entrance.', a_ja:'å…¬åœ’ã®å…¥å£ã§ã€‚', a_hira:'ã“ã†ãˆã‚“ ã® ã„ã‚Šãã¡ ã§ã€‚' },
    ];

    const ALL_WORDS = Array.from(new Set(VOCAB.map(v => v.en)));
    function makeChoices(correct, n=4){
      const pool = ALL_WORDS.filter(w => w!==correct);
      for(let i=pool.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[pool[i],pool[j]]=[pool[j],pool[i]];}
      const picks = pool.slice(0,n-1);
      const arr = [correct, ...picks];
      for(let i=arr.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[arr[i],arr[j]]=[arr[j],arr[i]];}
      return arr;
    }

    const QUIZ = [
      { cloze:'Turn ___ at the corner.', answers:['left'],    ja:'è§’ã§å·¦ã«æ›²ãŒã£ã¦ãã ã•ã„ã€‚', hira:'ã‹ã© ã§ ã²ã ã‚Š ã« ã¾ãŒã£ã¦ ãã ã•ã„ã€‚', full:'Turn left at the corner.' },
      { cloze:'Go ___ ahead.', answers:['straight'],          ja:'ã¾ã£ã™ãé€²ã‚“ã§ãã ã•ã„ã€‚', hira:'ã¾ã£ã™ã ã™ã™ã‚“ã§ ãã ã•ã„ã€‚', full:'Go straight ahead.' },
      { cloze:'The park is ___ the school.', answers:['next to'], ja:'å…¬åœ’ã¯å­¦æ ¡ã®éš£ã«ã‚ã‚Šã¾ã™ã€‚', hira:'ã“ã†ãˆã‚“ ã¯ ãŒã£ã“ã† ã® ã¨ãªã‚Š ã« ã‚ã‚Šã¾ã™ã€‚', full:'The park is next to the school.' },
      { cloze:'The restaurant is ___ the hospital.', answers:['across from'], ja:'ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³ã¯ç—…é™¢ã®å‘ã‹ã„ã«ã‚ã‚Šã¾ã™ã€‚', hira:'ã‚Œã™ã¨ã‚‰ã‚“ ã¯ ã³ã‚‡ã†ã„ã‚“ ã® ã‚€ã‹ã„ ã« ã‚ã‚Šã¾ã™ã€‚', full:'The restaurant is across from the hospital.' },
      { cloze:'The subway station is ___ the park and the supermarket.', answers:['between'], ja:'åœ°ä¸‹é‰„ã®é§…ã¯å…¬åœ’ã¨ã‚¹ãƒ¼ãƒ‘ãƒ¼ã®é–“ã«ã‚ã‚Šã¾ã™ã€‚', hira:'ã¡ã‹ã¦ã¤ ã® ãˆã ã¯ ã“ã†ãˆã‚“ ã¨ ã™ãƒ¼ã±ãƒ¼ ã® ã‚ã„ã  ã« ã‚ã‚Šã¾ã™ã€‚', full:'The subway station is between the park and the supermarket.' },
      { cloze:'The bus stop is on the ___.', answers:['left'], ja:'ãƒã‚¹åœã¯å·¦å´ã«ã‚ã‚Šã¾ã™ã€‚', hira:'ã°ã™ã¦ã„ ã¯ ã²ã ã‚ŠãŒã‚ ã« ã‚ã‚Šã¾ã™ã€‚', full:'The bus stop is on the left.' },
      { cloze:'Turn ___ at the traffic light.', answers:['right'], ja:'ä¿¡å·ã§å³ã«æ›²ãŒã£ã¦ãã ã•ã„ã€‚', hira:'ã—ã‚“ã”ã† ã§ ã¿ã ã« ã¾ãŒã£ã¦ ãã ã•ã„ã€‚', full:'Turn right at the traffic light.' },
      { cloze:'Go straight and you will see the ___.', answers:['supermarket'], ja:'ã¾ã£ã™ãé€²ã‚€ã¨ã€ã‚¹ãƒ¼ãƒ‘ãƒ¼ãŒè¦‹ãˆã¾ã™ã€‚', hira:'ã¾ã£ã™ã ã™ã™ã‚€ ã¨ã€ ã™ãƒ¼ã±ãƒ¼ ãŒ ã¿ãˆã¾ã™ã€‚', full:'Go straight and you will see the supermarket.' },
      { cloze:'Meet me at the park ___.', answers:['entrance'], ja:'å…¬åœ’ã®å…¥å£ã§ä¼šã„ã¾ã—ã‚‡ã†ã€‚', hira:'ã“ã†ãˆã‚“ ã® ã„ã‚Šãã¡ ã§ ã‚ã„ã¾ã—ã‚‡ã†ã€‚', full:'Meet me at the park entrance.' },
      { cloze:'The post office is ___ the station.', answers:['beside'], ja:'éƒµä¾¿å±€ã¯é§…ã®ãã°ã«ã‚ã‚Šã¾ã™ã€‚', hira:'ã‚†ã†ã³ã‚“ãã‚‡ã ã¯ ãˆã ã® ãã° ã« ã‚ã‚Šã¾ã™ã€‚', full:'The post office is beside the station.' },
      { cloze:'Take the ___ at the station.', answers:['subway'], ja:'é§…ã§åœ°ä¸‹é‰„ã«ä¹—ã£ã¦ãã ã•ã„ã€‚', hira:'ãˆã ã§ ã¡ã‹ã¦ã¤ ã« ã®ã£ã¦ ãã ã•ã„ã€‚', full:'Take the subway at the station.' },
      { cloze:'The airport is ___.', answers:['ahead'], ja:'ç©ºæ¸¯ã¯å‰æ–¹ã§ã™ã€‚', hira:'ãã†ã“ã† ã¯ ã¾ãˆ ã§ã™ã€‚', full:'The airport is ahead.' },
      { cloze:'Go straight to the ___.', answers:['station'], ja:'é§…ã¾ã§ã¾ã£ã™ãè¡Œã£ã¦ãã ã•ã„ã€‚', hira:'ãˆã ã¾ã§ ã¾ã£ã™ã ã„ã£ã¦ ãã ã•ã„ã€‚', full:'Go straight to the station.' },
      { cloze:'The school is ___ the park.', answers:['across from'], ja:'å­¦æ ¡ã¯å…¬åœ’ã®å‘ã‹ã„ã«ã‚ã‚Šã¾ã™ã€‚', hira:'ãŒã£ã“ã† ã¯ ã“ã†ãˆã‚“ ã® ã‚€ã‹ã„ ã« ã‚ã‚Šã¾ã™ã€‚', full:'The school is across from the park.' },
      { cloze:'The ___ is next to the restaurant.', answers:['hospital'], ja:'ç—…é™¢ã¯ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³ã®éš£ã§ã™ã€‚', hira:'ã³ã‚‡ã†ã„ã‚“ ã¯ ã‚Œã™ã¨ã‚‰ã‚“ ã® ã¨ãªã‚Š ã§ã™ã€‚', full:'The hospital is next to the restaurant.' },
      { cloze:'Go ___ and turn right.', answers:['straight'], ja:'ã¾ã£ã™ãè¡Œã£ã¦å³ã«æ›²ãŒã£ã¦ãã ã•ã„ã€‚', hira:'ã¾ã£ã™ã ã„ã£ã¦ ã¿ã ã« ã¾ãŒã£ã¦ ãã ã•ã„ã€‚', full:'Go straight and turn right.' },
      { cloze:'The ___ is between the city and the sea.', answers:['airport'], ja:'ç©ºæ¸¯ã¯è¡—ã¨æµ·ã®é–“ã«ã‚ã‚Šã¾ã™ã€‚', hira:'ãã†ã“ã† ã¯ ã¾ã¡ ã¨ ã†ã¿ ã® ã‚ã„ã  ã« ã‚ã‚Šã¾ã™ã€‚', full:'The airport is between the city and the sea.' },
      { cloze:'Is the ___ far from here?', answers:['restaurant'], ja:'ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³ã¯ã“ã“ã‹ã‚‰é ã„ã§ã™ã‹ï¼Ÿ', hira:'ã‚Œã™ã¨ã‚‰ã‚“ ã¯ ã“ã“ ã‹ã‚‰ ã¨ãŠã„ ã§ã™ã‹ï¼Ÿ', full:'Is the restaurant far from here?' },
      { cloze:'The bus stop is by the ___.', answers:['station'], ja:'ãƒã‚¹åœã¯é§…ã®ãã°ã§ã™ã€‚', hira:'ã°ã™ã¦ã„ ã¯ ãˆã ã® ãã° ã§ã™ã€‚', full:'The bus stop is by the station.' },
      { cloze:'Turn at the ___.', answers:['corner'], ja:'è§’ã§æ›²ãŒã£ã¦ãã ã•ã„ã€‚', hira:'ã‹ã© ã§ ã¾ãŒã£ã¦ ãã ã•ã„ã€‚', full:'Turn at the corner.' },
    ].map(q => ({ ...q, choices: q.choices || makeChoices(q.answers[0]) }));

    const READINGS = [
      { en:'Go straight to the station. The station is big.', ja:'é§…ã¾ã§ã¾ã£ã™ãè¡Œã£ã¦ãã ã•ã„ã€‚é§…ã¯å¤§ãã„ã§ã™ã€‚', hira:'ãˆã ã¾ã§ ã¾ã£ã™ã ã„ã£ã¦ ãã ã•ã„ã€‚ ãˆã ã¯ ãŠãŠãã„ ã§ã™ã€‚' },
      { en:'The park is next to the school. Many children play there.', ja:'å…¬åœ’ã¯å­¦æ ¡ã®éš£ã«ã‚ã‚Šã¾ã™ã€‚å­ã©ã‚‚ãŒãŸãã•ã‚“éŠã³ã¾ã™ã€‚', hira:'ã“ã†ãˆã‚“ ã¯ ãŒã£ã“ã† ã® ã¨ãªã‚Š ã« ã‚ã‚Šã¾ã™ã€‚ ã“ã©ã‚‚ ãŒ ãŸãã•ã‚“ ã‚ãã³ã¾ã™ã€‚' },
      { en:'Turn right at the corner. You will see the restaurant.', ja:'è§’ã§å³ã«æ›²ãŒã£ã¦ãã ã•ã„ã€‚ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³ãŒè¦‹ãˆã¾ã™ã€‚', hira:'ã‹ã© ã§ ã¿ã ã« ã¾ãŒã£ã¦ ãã ã•ã„ã€‚ ã‚Œã™ã¨ã‚‰ã‚“ ãŒ ã¿ãˆã¾ã™ã€‚' },
      { en:'The post office is across from the station. It is easy to find.', ja:'éƒµä¾¿å±€ã¯é§…ã®å‘ã‹ã„ã«ã‚ã‚Šã¾ã™ã€‚è¦‹ã¤ã‘ã‚„ã™ã„ã§ã™ã€‚', hira:'ã‚†ã†ã³ã‚“ãã‚‡ã ã¯ ãˆã ã® ã‚€ã‹ã„ ã« ã‚ã‚Šã¾ã™ã€‚ ã¿ã¤ã‘ ã‚„ã™ã„ ã§ã™ã€‚' },
      { en:'The hospital is beside the park. It is quiet there.', ja:'ç—…é™¢ã¯å…¬åœ’ã®ãã°ã«ã‚ã‚Šã¾ã™ã€‚ãã“ã¯é™ã‹ã§ã™ã€‚', hira:'ã³ã‚‡ã†ã„ã‚“ ã¯ ã“ã†ãˆã‚“ ã® ãã° ã« ã‚ã‚Šã¾ã™ã€‚ ãã“ ã¯ ã—ãšã‹ ã§ã™ã€‚' },
      { en:'Go straight and use the subway. It is fast.', ja:'ã¾ã£ã™ãè¡Œã£ã¦åœ°ä¸‹é‰„ã‚’ä½¿ã£ã¦ãã ã•ã„ã€‚é€Ÿã„ã§ã™ã€‚', hira:'ã¾ã£ã™ã ã„ã£ã¦ ã¡ã‹ã¦ã¤ ã‚’ ã¤ã‹ã£ã¦ ãã ã•ã„ã€‚ ã¯ã‚„ã„ ã§ã™ã€‚' },
      { en:'The airport is between the city and the sea. Many planes come and go.', ja:'ç©ºæ¸¯ã¯è¡—ã¨æµ·ã®é–“ã«ã‚ã‚Šã¾ã™ã€‚å¤šãã®é£›è¡Œæ©ŸãŒè¡Œãæ¥ã—ã¾ã™ã€‚', hira:'ãã†ã“ã† ã¯ ã¾ã¡ ã¨ ã†ã¿ ã® ã‚ã„ã  ã« ã‚ã‚Šã¾ã™ã€‚ ãŠãŠã ã® ã²ã“ã†ã ãŒ ã„ãã ã—ã¾ã™ã€‚' },
      { en:'Is the supermarket far? No, it is ahead on the left.', ja:'ã‚¹ãƒ¼ãƒ‘ãƒ¼ã¯é ã„ã§ã™ã‹ï¼Ÿã„ã„ãˆã€å·¦ã®å‰æ–¹ã§ã™ã€‚', hira:'ã™ãƒ¼ã±ãƒ¼ ã¯ ã¨ãŠã„ ã§ã™ã‹ï¼Ÿ ã„ã„ãˆã€ ã²ã ã‚Š ã® ã¾ãˆ ã§ã™ã€‚' },
      { en:'Meet me at the park entrance at three.', ja:'3æ™‚ã«å…¬åœ’ã®å…¥å£ã§ä¼šã„ã¾ã—ã‚‡ã†ã€‚', hira:'ã•ã‚“ã˜ ã« ã“ã†ãˆã‚“ ã® ã„ã‚Šãã¡ ã§ ã‚ã„ã¾ã—ã‚‡ã†ã€‚' },
      { en:'The school is straight ahead. Turn right for the gym.', ja:'å­¦æ ¡ã¯ã¾ã£ã™ãå‰ã§ã™ã€‚ä½“è‚²é¤¨ã¯å³ã«æ›²ãŒã£ã¦ãã ã•ã„ã€‚', hira:'ãŒã£ã“ã† ã¯ ã¾ã£ã™ã ã¾ãˆ ã§ã™ã€‚ ãŸã„ã„ãã‹ã‚“ ã¯ ã¿ã ã« ã¾ãŒã£ã¦ ãã ã•ã„ã€‚' },
    ];

    // Diary prompts now show a HINT on the FRONT as requested
    const DIARY = [
      { en:'Write about how you go to school.',
        ja:'å­¦æ ¡ã¸ã®è¡Œãæ–¹ã«ã¤ã„ã¦æ›¸ãã¾ã—ã‚‡ã†ã€‚',
        hira:'ãŒã£ã“ã† ã¸ã® ã„ãã‹ãŸ ã«ã¤ã„ã¦ ã‹ãã¾ã—ã‚‡ã†ã€‚',
        hints:[
          'Use: go straight / turn left / turn right',
          'Mention: station / bus stop / park',
          'Example opener: I go straight to the bus stop...'
        ] },
      { en:'Describe a place near your house.',
        ja:'å®¶ã®è¿‘ãã®å ´æ‰€ã‚’ç´¹ä»‹ã—ã¾ã—ã‚‡ã†ã€‚',
        hira:'ã„ãˆ ã® ã¡ã‹ã ã® ã°ã—ã‚‡ ã‚’ ã—ã‚‡ã†ã‹ã„ ã—ã¾ã—ã‚‡ã†ã€‚',
        hints:[
          'Use: next to / across from / beside',
          'Place: supermarket / school / restaurant',
          'Add distance: near / far'
        ] },
      { en:'Give directions to your favorite restaurant.',
        ja:'ãŠæ°—ã«å…¥ã‚Šã®ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³ã¸ã®è¡Œãæ–¹ã‚’æ›¸ãã¾ã—ã‚‡ã†ã€‚',
        hira:'ãŠãã«ã„ã‚Š ã® ã‚Œã™ã¨ã‚‰ã‚“ ã¸ã® ã„ãã‹ãŸ ã‚’ ã‹ãã¾ã—ã‚‡ã†ã€‚',
        hints:[
          'Start at: station or bus stop',
          'Use: turn at the corner / go straight ahead',
          'Finish: It is on the left/right.'
        ] },
      { en:'Write about a time you got lost.',
        ja:'è¿·ã£ãŸã¨ãã®ã“ã¨ã‚’æ›¸ãã¾ã—ã‚‡ã†ã€‚',
        hira:'ã¾ã‚ˆã£ãŸ ã¨ã ã® ã“ã¨ ã‚’ ã‹ãã¾ã—ã‚‡ã†ã€‚',
        hints:[
          'Question you asked: Where is the ___?',
          'What helped: map / signs / people',
          'How you felt: worried / okay'
        ] },
      { en:'Plan a trip from the station to the airport.',
        ja:'é§…ã‹ã‚‰ç©ºæ¸¯ã¾ã§ã®è¨ˆç”»ã‚’æ›¸ãã¾ã—ã‚‡ã†ã€‚',
        hira:'ãˆã ã‹ã‚‰ ãã†ã“ã† ã¾ã§ ã® ã‘ã„ã‹ã ã‚’ ã‹ãã¾ã—ã‚‡ã†ã€‚',
        hints:[
          'Transport: subway / bus',
          'Landmarks: park / hospital / post office',
          'Timing: Go straight for 10 minutes, then turn right.'
        ] },
    ];

    // -------------- State & Elements --------------
    let deck = [];
    let index = 0;
    let showingFront = true;

    const els = {
      mode: document.getElementById('mode'),
      card: document.getElementById('card'),
      label: document.getElementById('label'),
      main: document.getElementById('main'),
      sub: document.getElementById('sub'),
      hira: document.getElementById('hira'),
      counter: document.getElementById('counter'),
      bar: document.getElementById('bar'),
      btnPrev: document.getElementById('btnPrev'),
      btnNext: document.getElementById('btnNext'),
      btnFlip: document.getElementById('btnFlip'),
      btnShuffle: document.getElementById('btnShuffle'),
      mcArea: document.getElementById('mcArea'),
    };

    function shuffle(arr){ for(let i=arr.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[arr[i],arr[j]]=[arr[j],arr[i]]} return arr; }

    function buildDeck(){
      const mode=els.mode.value;
      if(mode==='vocab-j2e' || mode==='vocab-e2j'){
        deck=VOCAB.map(x=>({
          type:'vocab',
          front:mode==='vocab-j2e'?x.ja:x.en,
          back:mode==='vocab-j2e'?`${x.en} / ${x.ja}`:`${x.ja} / ${x.en}`,
          hira:x.hira,
          sideLabelFront:mode==='vocab-j2e'?'Japanese â†’ English':'English â†’ Japanese',
          sideLabelBack:'Answer'
        }));
      } else if(mode==='sentences'){
        deck=SENTENCES.map(s=>({
          type:'sentence',
          front:s.ja,
          back:s.en+'\n'+s.ja,
          hira:s.hira,
          sideLabelFront:'Japanese sentence',
          sideLabelBack:'Answer'
        }));
      } else if(mode==='qa'){
        deck=QA.map(q=>({
          type:'qa',
          front:q.q_ja,
          back:q.a_en+'\n'+q.a_ja,
          hira:q.q_hira+'\n'+q.a_hira,
          sideLabelFront:'Question (JA)',
          sideLabelBack:'Answer'
        }));
      } else if(mode==='quiz'){
        deck=QUIZ.map(q=>({
          type:'quiz',
          front:q.cloze,
          back:q.full+'\n'+q.ja,
          hira:q.hira,
          answers:q.answers,
          choices:q.choices,
          sideLabelFront:'Choose',
          sideLabelBack:'Answer'
        }));
      } else if(mode==='reading'){
        deck=READINGS.map(r=>({
          type:'reading',
          front:r.ja,
          back:r.en+'\n'+r.ja,
          hira:r.hira,
          sideLabelFront:'Reading (JA)',
          sideLabelBack:'Reading (EN+JA)'
        }));
      } else if(mode==='diary'){
        // Show one hint ON THE FRONT (first hint), rest on the back
        deck=DIARY.map(d=>{
          const frontHint = d.hints && d.hints.length ? `\nãƒ’ãƒ³ãƒˆï¼š${d.hints[0]}` : '';
          return {
            type:'diary',
            front: d.ja + frontHint,
            back: d.en + '\n' + (d.hints ? ('Hints:\n- ' + d.hints.join('\n- ')) : ''),
            hira:d.hira,
            sideLabelFront:'Diary idea (JA + Hint)',
            sideLabelBack:'EN + All Hints'
          };
        });
      } else { deck=[]; }
      index=0;showingFront=true;render();
    }

    function render(){
      if(deck.length===0){els.main.textContent='â€”'; els.sub.textContent='Choose a mode'; return;}
      const item=deck[index];
      els.label.textContent=showingFront?item.sideLabelFront:item.sideLabelBack;
      const content=showingFront?item.front:item.back;
      if(!showingFront && content.includes('\n')){
        const [en,jaOrRest]=content.split('\n',2);
        els.main.innerHTML=`<div style="font-size:22px;font-weight:700;white-space:pre-line">${en}</div><div class="sub" style="white-space:pre-line">${jaOrRest}</div>`;
      } else { els.main.textContent=content; }
      if(item.hira){ els.hira.classList.remove('hidden'); els.hira.textContent=item.hira; } 
      else { els.hira.classList.add('hidden'); els.hira.textContent=''; }

      if(item.type==='quiz' && showingFront){
        els.mcArea.classList.remove('hidden'); els.mcArea.innerHTML='';
        item.choices.forEach(opt=>{
          const btn=document.createElement('button'); btn.className='optbtn'; btn.textContent=opt;
          btn.addEventListener('click',e=>{
            e.preventDefault();
            const norm=s=>s.toLowerCase().trim();
            const isCorrect=item.answers.map(a=>norm(a)).includes(norm(opt));
            if(isCorrect){
              btn.classList.add('ok');
              [...els.mcArea.querySelectorAll('button')].forEach(b=>b.disabled=true);
              setTimeout(()=>{showingFront=false;render();},300);
            } else { btn.classList.add('bad'); btn.disabled=true; }
          });
          els.mcArea.appendChild(btn);
        });
      } else { els.mcArea.classList.add('hidden'); els.mcArea.innerHTML=''; }
      els.counter.textContent=`${index+1} / ${deck.length}`; els.bar.style.width=`${((index+1)/deck.length)*100}%`;
    }

    // Nav
    function prev(){index=(index-1+deck.length)%deck.length;showingFront=true;render();}
    function next(){index=(index+1)%deck.length;showingFront=true;render();}
    function flip(){showingFront=!showingFront;render();}
    function shuffleDeck(){deck=shuffle(deck);index=0;showingFront=true;render();}

    // Events
    document.getElementById('mode').addEventListener('change',buildDeck);
    document.getElementById('btnPrev').addEventListener('click',prev);
    document.getElementById('btnNext').addEventListener('click',next);
    document.getElementById('btnFlip').addEventListener('click',flip);
    document.getElementById('btnShuffle').addEventListener('click',shuffleDeck);
    window.addEventListener('keydown',e=>{if(e.code==='ArrowLeft')prev(); else if(e.code==='ArrowRight')next(); else if(e.code==='Space'){e.preventDefault();flip();}});

    // Init
    buildDeck();
  </script>
</body>
</html>
